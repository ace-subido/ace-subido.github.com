<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Circuit Breaking in Ruby</title>
  <meta name="description" content="What is Circuit Breaking?">

  <meta name="twitter:card" content="summary_large_image">
  <meta content="acesubido" property="og:site_name">

  
    <meta content="Circuit Breaking in Ruby" property="og:title">
    <meta content="Circuit Breaking in Ruby" property="twitter:title">
  

  
    <meta content="article" property="og:type">
  

  
    <meta content="What is Circuit Breaking?" property="og:description">
    <meta content="What is Circuit Breaking?" property="twitter:description">
  

  
    <meta content="https://acesubido.net/2019/10/11/circuit-breaking-in-ruby.html" property="og:url">
  

  
    <meta content="2019-10-11T00:00:00-04:00" property="article:published_time">
    <meta content="https://acesubido.net/about/" property="article:author">
  

  
    <meta content="https://acesubido.net/img/logo-hires.png" property="og:image">
    <meta content="https://acesubido.net/img/logo-hires.png" property="twitter:image">
  

  <link rel="stylesheet" href="https://acesubido.net/assets/css/main.css">
  <link rel="canonical" href="https://acesubido.net/2019/10/11/circuit-breaking-in-ruby.html">
  <link rel="alternate" type="application/rss+xml" title="acesubido" href="/feed.xml" />
  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico"/>
</head>

  <body>
    <header class="site-header">
  <div class="site-title">
    <ul class="navigation-links-list">
      <li>
        acesubido
        &mdash;
      </li>
      <li>
        <a href="/">home</a>
      </li>
      <li>
        <a href="/posts">blog</a>
      </li>
      <li>
        <a href="/contact">contact</a>
      </li>
      <li>
        <a href="/feed.xml">rss feed</a>
      </li>
    </ul>
  </div>
</header>

    <div class="container">
      <section class="post-full">
  <header>
    <span class="post-date text-muted">
      Oct 11, 2019
      
      
    </span>
    <h1 class="post-full-title">Circuit Breaking in Ruby</h1>
  </header>
  <article>
    <h3 id="what-is-circuit-breaking">What is Circuit Breaking?</h3>

<p>Imagine you’ve got a piece of code making multiple remote calls: some 3rd party, some internal. Then out of nowhere, you get a timeout error. Your whole stack collapses, and you get a raise exception in Bugsnag. Of course, we’d want our application to degrade gracefully. If it’s network related issue, one way to make it degrade gracefully is to keep retrying the call instead of blowing up in the first sight of a network-related exception like <code class="language-plaintext highlighter-rouge">TimeoutError</code>.</p>

<p>Michael Nygard popularized the Circuit Breaker pattern to prevent this kind of catastrophic cascade. It’s a pattern where you wrap those calls in a loop where it keeps retrying once it rescues a network-related exception.</p>

<p>Here’s what it looks like using Ruby:</p>

<p>Use either <code class="language-plaintext highlighter-rouge">yammer/circuitbox</code> or the more straightforward <code class="language-plaintext highlighter-rouge">ooyala/retries</code>. Here’s what it looks like with the <code class="language-plaintext highlighter-rouge">retries</code> gem:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>exception_list = [
  HTTPClient::ReceiveTimeoutError,
  # etc.
]

with_retries(max_tries: 3, rescue: exception_list) do |attempt_number|
  # Call an external service that CAN be prone to failures
end
</code></pre></div></div>

<p>That’ll keep retrying that block of code 3 times in a randomized interval. Even if it encounters raised errors in that exception list — a simple pattern to make your application work a little smoother.</p>


  </article>
  <hr>
  <div class="post-navigation">
    
      <a class="prev" href="/2019/09/27/part-2-napkin-math-owning-a-yacht.html">
        <strong>Previous</strong><br>
        Part 2 - Napkin Math: Owning a yacht
      </a>
    
    
      <a class="next" href="/2019/10/21/rails-logger-silence-and-threading.html">
        <strong>Next</strong><br>
        Rails.logger.silence and threading
      </a>
    
  </div>
</section>

    </div>
    <footer class="site-footer">
  <nav class="footer-links">
    <ul class="navigation-links-list">
      <li>
        acesubido
        &mdash;
      </li>
      <li>
        <a href="/">home</a>
      </li>
      <li>
        <a href="/posts">blog</a>
      </li>
      <li>
        <a href="/contact">contact</a>
      </li>
      <li>
        <a href="/feed.xml">rss feed</a>
      </li>
    </ul>
  </nav>
</footer>

<script type="text/javascript" src="/assets/js/google-analytics.js"></script>

  </body>

</html>
