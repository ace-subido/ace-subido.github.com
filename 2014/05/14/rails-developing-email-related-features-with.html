<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Rails: Developing Email-related features with rspec, email-spec and letter_opener</title>
  <meta name="description" content="After years of being a developer, (.NET and Grails, now I&rsquo;m 3 months into Ruby-land), I always run into productivity problems when developing email-rel...">

  <meta content="acesubido" property="og:site_name">
  
    <meta content="Rails: Developing Email-related features with rspec, email-spec and letter_opener" property="og:title">
  

  
    <meta content="article" property="og:type">
  

  
    <meta content="my journal on work and life" property="og:description">
  

  
    <meta content="http://acesubido.com/2014/05/14/rails-developing-email-related-features-with.html" property="og:url">
  

  
    <meta content="2014-05-14T19:45:00+08:00" property="article:published_time">
    <meta content="http://acesubido.com/about/" property="article:author">
  

  
    <meta content="/img/logo-hires.png" property="og:image">
  

  <meta name="twitter:title" content="European Travel Destinations ">
  <meta name="twitter:description" content=" Offering tour packages for individuals or groups.">
  <meta name="twitter:image" content=" http://euro-travel-example.com/thumbnail.jpg">
  <meta name="twitter:card" content="summary_large_image">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://acesubido.com/2014/05/14/rails-developing-email-related-features-with.html">
  <link rel="alternate" type="application/rss+xml" title="acesubido" href="/feed.xml" />
  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico"/>
</head>

  <body>
    <header class="site-header">
  <div class="site-title">
    <ul class="navigation-links-list">
      <li>
        acesubido
        &mdash;
      </li>
      <li>
        <a href="/">posts</a>
      </li>
      <li>
        <a href="/about">about/contact</a>
      </li>
      <li>
        <a href="/feed.xml">subscribe via rss</a>
      </li>
    </ul>
  </div>
</header>

    <div class="container">
      <section class="post-full">
  <header>
    <h1 class="post-full-title">Rails: Developing Email-related features with rspec, email-spec and letter_opener</h1>
    <span class="post-date">
      May 14, 2014
      
      
    </span>
  </header>
  <hr class="post-divider"/>
  <article>
    <p>After years of being a developer, (.NET and Grails, now I&rsquo;m 3 months into Ruby-land), I always run into productivity problems when developing email-related features. Here&rsquo;s why:</p>

<ol><li>Write/Fix the code</li>
<li>Send the email to an inbox</li>
<li>Open the inbox</li>
<li>Find something wrong</li>
<li>Repeat 1-4 until satisfied</li>
</ol><p>Sounds easy, but it&rsquo;s really tedious. Your inbox fills up with test emails. Your <a href="http://en.wikipedia.org/wiki/Flow_(psychology)" target="_blank">&lsquo;flow&rsquo;</a> gets broken. So recently, I&rsquo;ve marked a new milestone in my development career: that doesn&rsquo;t happen anymore. Instead, this happens:</p>

<ol><li>Write a test, expecting what I want to appear in an email.</li>
<li>Write the code</li>
<li>Run the test, find something wrong</li>
<li>(Optional) Run the mailer in the rails console, email pops up as an HTML file in my browser</li>
<li>Repeat 1-4 until satisfied.</li>
</ol><p>No more inbox related stuff, and I can cycle quickly through the usual development loop.</p>

<p><strong>rspec</strong>, <strong>email_spec</strong> and <strong>letter_opener</strong> are the keys to how I became productive. Combining these gems are one of the many ways to get productive in churning out email-related code, but so far this is my most favorite.</p>

<h3>rspec/email-spec</h3>

<p><strong>rspec</strong> needs no introduction &ndash; simply put, it&rsquo;s a unit testing framework for ruby.</p>

<p>I don&rsquo;t write unit tests for all of my code, since I know I&rsquo;ll go crazy when I do and it&rsquo;ll be counterproductive. I only write tests for my code when:</p>

<ol><li>It&rsquo;s a piece of the system that&rsquo;s really important and prone to errors.</li>
<li>It&rsquo;s a pain to replicate manually.</li>
</ol><p>To cut it short, Unit tests helps me be confident that whatever I&rsquo;m expecting to send in an email, is actually written there in that email.</p>

<p><strong>email_spec</strong> are helpers for rspec to test emails. Taken right out of the README:</p>

<pre><code>describe "Signup Email" do
  include EmailSpec::Helpers
  include EmailSpec::Matchers
  # include ActionController::UrlWriter - old rails
  include Rails.application.routes.url_helpers

  before(:all) do
     @email = UserMailer.create_signup("jojo@yahoo.com", "Jojo Binks")
  end

  it "should be set to be delivered to the email passed in" do
    @email.should deliver_to("jojo@yahoo.com")
  end

  it "should contain the user's message in the mail body" do
    @email.should have_body_text(/Jojo Binks/)
  end

  it "should contain a link to the confirmation link" do
    @email.should have_body_text(/#{confirm_account_url}/)
  end

  it "should have the correct subject" do
    @email.should have_subject(/Account confirmation/)
  end

end
</code></pre>

<h3>letter_opener</h3>

<p><strong>letter_opener</strong> sends the email in the browser as an HTML file instead of really sending it. This means you do not need to set up email delivery in your development environment. Helpful for styling emails, and for integration tests (Cukes)</p>

<p>Taken right out of the <code>README</code>:</p>

<p>First add the gem to your development environment and run the <code>bundle</code> command to install it.</p>

<pre><code>gem "letter_opener", :group =&gt; :development
</code></pre>

<p>Then set the delivery method in <code>config/environments/development.rb</code></p>

<pre><code>config.action_mailer.delivery_method = :letter_opener
</code></pre>

<p>Now any email will pop up in your browser instead of being sent. The messages are stored in <code>tmp/letter_opener</code></p>

<p>TL;DR</p>

<p>rspec + letter_opener = developing any email-related feature is no longer painful.</p>

  </article>
</section>

    </div>
    <footer class="site-footer">
  <nav class="footer-links">
    <ul class="navigation-links-list">
      <li>
        acesubido
        &mdash;
      </li>
      <li>
        <a href="/">posts</a>
      </li>
      <li>
        <a href="/about">about/contact</a>
      </li>
      <li>
        <a href="/feed.xml">subscribe via rss</a>
      </li>
    </ul>
  </nav>
</footer>

<script type="text/javascript" src="/javascript/google-analytics.js"></script>

  </body>

</html>
